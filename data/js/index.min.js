function initializeIndexUI(){const e=document.getElementById("message-textarea");e&&(e.addEventListener("input",()=>updateCharacterCount("message-textarea","char-counter",MAX_CHARS)),updateCharacterCount("message-textarea","char-counter",MAX_CHARS))}function initializePrinterSelection(){const e=document.getElementById("printer-selection");if(!e)return;e.innerHTML="";const t=createPrinterOption("local-direct","ðŸ–¨ï¸",`Local direct (${window.GLOBAL_CONFIG?.printer?.name||"Unknown"})`,!0,null);e.appendChild(t),"undefined"!=typeof PRINTERS&&PRINTERS.forEach(t=>{const r=createPrinterOption(`scribe/${t.name}/print`,"ðŸ“¡",`${t.name} via MQTT`,!1,t);e.appendChild(r)})}function createPrinterOption(e,t,r,n=!1,a=null){const i=document.createElement("div");i.className="printer-option cursor-pointer p-4 rounded-xl border-2 transition-all duration-200 hover:scale-105 hover:shadow-md "+(n?"border-orange-400 bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 dark:border-orange-600":"border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500"),i.setAttribute("data-value",e);let o="",d=!1;"local-direct"===e?o="Direct connection":(o="Direct connection",d=!0);const s=document.createElement("div");s.className="flex items-center justify-between w-full";const l=document.createElement("div");if(l.className="flex items-center space-x-3 flex-1 min-w-0",l.innerHTML=`\n    <span class="text-2xl">${t}</span>\n    <div class="flex-1 min-w-0">\n      <div class="font-medium text-sm truncate">${r}</div>\n      ${"local-direct"===e?'<div class="text-xs text-gray-500 dark:text-gray-400 truncate">Direct connection</div>':""}\n    </div>\n  `,s.appendChild(l),d&&a){const e=document.createElement("div");e.className="info-icon ml-3 flex-shrink-0 w-11 h-11 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-600 hover:bg-gray-200 dark:hover:bg-gray-500 transition-colors duration-200 cursor-pointer",e.innerHTML='<span class="text-lg text-gray-600 dark:text-gray-300">â“˜</span>',e.title="View printer details",e.style.minWidth="44px",e.style.minHeight="44px",e.setAttribute("data-printer-info",JSON.stringify(a)),e.setAttribute("data-printer-name",a.name||"Unknown"),e.setAttribute("data-printer-topic",`scribe/${a.name}/print`),e.addEventListener("click",e=>{e.stopPropagation(),showPrinterInfoOverlay(a,a.name||"Unknown")}),s.appendChild(e)}return i.appendChild(s),l.addEventListener("click",()=>selectPrinter(e,i)),i}function selectPrinter(e,t){document.querySelectorAll(".printer-option").forEach(e=>{e.className=e.className.replace(/border-orange-400|bg-orange-50|text-orange-700|dark:bg-orange-900\/20|dark:text-orange-300|dark:border-orange-600/g,"").replace(/border-gray-200|bg-gray-50|text-gray-700|dark:border-gray-600|dark:bg-gray-700|dark:text-gray-300/g,"")+" border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:border-gray-300 dark:hover:border-gray-500"}),t.className=t.className.replace(/border-gray-200|bg-gray-50|text-gray-700|hover:border-gray-300|dark:border-gray-600|dark:bg-gray-700|dark:text-gray-300|dark:hover:border-gray-500/g,"")+" border-orange-400 bg-orange-50 dark:bg-orange-900/20 text-orange-700 dark:text-orange-300 dark:border-orange-600";const r=document.getElementById("printer-target");r&&(r.value=e)}function initializeConfigDependentUI(){initializePrinterSelection()}function updateCharacterCount(e,t,r=1e3){const n=document.getElementById(e),a=document.getElementById(t);if(n&&a){const e=n.value.length,t=r;a.textContent=`${e}/${t} characters`;const i=a.parentElement;i&&(i.classList.remove("text-gray-500","text-yellow-700","text-red-600","dark:text-gray-400","dark:text-yellow-300","dark:text-red-400"),e>t?i.classList.add("text-red-600","dark:text-red-400"):e>=.8*t?i.classList.add("text-yellow-700","dark:text-yellow-300"):i.classList.add("text-gray-500","dark:text-gray-400"))}}function showPrinterInfoOverlay(e,t){const r=document.getElementById("printer-info-overlay");r&&r.remove();const n=document.createElement("div");n.id="printer-info-overlay",n.className="fixed inset-0 z-50 flex items-end sm:items-center sm:justify-center p-4";const a=document.createElement("div");a.className="absolute inset-0 bg-black bg-opacity-50 backdrop-blur-sm",a.addEventListener("click",()=>closePrinterInfoOverlay());const i=document.createElement("div");i.className="relative bg-white dark:bg-gray-800 rounded-t-2xl sm:rounded-2xl w-full max-w-md max-h-[80vh] overflow-y-auto shadow-2xl transform transition-all duration-300 ease-out";const o=`scribe/${t}/print`,d=e.ip_address||"Not available",s=e.mdns||`${t.toLowerCase()}.local`,l=e.firmware_version||"Not available";let c="Not available";if(e.last_power_on){const t=new Date(e.last_power_on),r=(new Date).getTime()-t.getTime(),n=Math.floor(r/36e5),a=Math.floor(n/24);c=a>0?`Started ${a} day${a>1?"s":""} ago`:n>0?`Started ${n} hour${n>1?"s":""} ago`:"Started recently"}const g=e.timezone||"Same as local";i.innerHTML=`\n    <div class="p-6">\n      \x3c!-- Header with close button --\x3e\n      <div class="flex items-center justify-between mb-6">\n        <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 flex items-center">\n          <span class="text-2xl mr-2">ðŸ“¡</span>\n          ${t} Details\n        </h3>\n        <button onclick="closePrinterInfoOverlay()" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200">\n          <span class="text-gray-600 dark:text-gray-400 text-xl">Ã—</span>\n        </button>\n      </div>\n      \n      \x3c!-- Information sections --\x3e\n      <div class="space-y-4">\n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">MQTT Topic</div>\n          <div class="text-sm bg-gray-50 dark:bg-gray-700 p-3 rounded-lg font-mono text-gray-800 dark:text-gray-200 break-all">\n            ${o}\n          </div>\n        </div>\n        \n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">IP Address</div>\n          <div class="text-sm text-gray-800 dark:text-gray-200">${d}</div>\n        </div>\n        \n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">mDNS</div>\n          <div class="text-sm text-gray-800 dark:text-gray-200">${s}</div>\n        </div>\n        \n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Firmware Version</div>\n          <div class="text-sm text-gray-800 dark:text-gray-200">${l}</div>\n        </div>\n        \n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Last Power On</div>\n          <div class="text-sm text-gray-800 dark:text-gray-200">${c}</div>\n        </div>\n        \n        <div>\n          <div class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Timezone</div>\n          <div class="text-sm text-gray-800 dark:text-gray-200">${g}</div>\n        </div>\n      </div>\n    </div>\n  `,n.appendChild(a),n.appendChild(i),document.body.appendChild(n),requestAnimationFrame(()=>{n.style.opacity="1",i.style.transform="translateY(0)"}),n.style.opacity="0",i.style.transform="translateY(100%)",document.addEventListener("keydown",handleOverlayEscape)}function closePrinterInfoOverlay(){const e=document.getElementById("printer-info-overlay");if(e){const t=e.querySelector(".relative");e.style.opacity="0",t&&(t.style.transform="translateY(100%)"),setTimeout(()=>{e.remove(),document.removeEventListener("keydown",handleOverlayEscape)},300)}}function handleOverlayEscape(e){"Escape"===e.key&&closePrinterInfoOverlay()}function goToSettings(){window.location.href="/settings.html"}function checkForSettingsSuccess(){if("true"===new URLSearchParams(window.location.search).get("settings_saved")){showSuccessToast("Your Scribe settings have been tucked away safely");const e=window.location.pathname;window.history.replaceState({},document.title,e)}}function showSuccessToast(e){let t=document.getElementById("toast-container");t||(t=document.createElement("div"),t.id="toast-container",t.className="fixed top-4 right-4 z-50 space-y-2",document.body.appendChild(t));const r=document.createElement("div");r.className="bg-green-100 text-green-800 border border-green-200 p-4 rounded-lg shadow-lg transition-all duration-300 transform translate-x-0 opacity-100 max-w-sm",r.innerHTML=`\n    <div class="flex items-center space-x-2">\n      <span class="text-xl">âœ…</span>\n      <span class="flex-1">${e}</span>\n      <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-lg font-bold opacity-50 hover:opacity-100">Ã—</button>\n    </div>\n  `,t.appendChild(r),setTimeout(()=>{r.parentElement&&(r.classList.add("translate-x-full","opacity-0"),setTimeout(()=>{r.parentElement&&r.remove()},300))},4e3)}document.addEventListener("DOMContentLoaded",function(){initializeIndexUI(),initializeConfigDependentUI(),initializePrinterDiscovery(),checkForSettingsSuccess(),document.addEventListener("printersUpdated",function(e){console.log("ðŸ”„ Printers updated, refreshing index page printer selection"),initializePrinterSelection()})});